{"version":3,"sources":["../../../src/models/sources/touch-scroll-source.ts"],"names":[],"mappings":"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","file":"touch-scroll-source.js","sourceRoot":"","sourcesContent":["import { NgZone } from '@angular/core';\nimport { Power4 } from 'gsap';\n\nimport { ScrollHandler } from '../handlers/scroll-handler';\nimport { ScrollSource } from './scroll-source.interface';\n\nexport class TouchScrollSource implements ScrollSource {\n\n  touchStartListener: any;\n  touchMoveListener: any;\n  touchEndListener: any;\n  lastTouch;\n  touchMoves = [];\n  dragging = false;\n\n  constructor(private scrollHandler: ScrollHandler,\n              private zone: NgZone) { }\n\n  bind() {\n    this.zone.runOutsideAngular(() => {\n      this.touchStartListener = e => {\n        return this.handleTouchStartEvent(e);\n      };\n\n      this.touchMoveListener = e => {\n        return this.handleTouchMoveEvent(e);\n      };\n\n      this.touchEndListener = e => {\n        return this.handleTouchEndEvent(e);\n      };\n\n      window.addEventListener('touchstart', this.touchStartListener);\n      window.addEventListener('touchmove', this.touchMoveListener);\n      window.addEventListener('touchend', this.touchEndListener);\n      window.addEventListener('touchcancel', this.touchEndListener);\n    });\n  }\n\n  unbind() {\n    if (this.touchStartListener) {\n      window.removeEventListener('touchstart', this.touchStartListener);\n    }\n\n    if (this.touchMoveListener) {\n      window.removeEventListener('touchmove', this.touchEndListener);\n    }\n\n    if (this.touchEndListener) {\n      window.removeEventListener('touchend', this.touchMoveListener);\n      window.removeEventListener('touchcancel', this.touchMoveListener);\n    }\n  }\n\n  handleTouchStartEvent(e) {\n    if (!this.scrollHandler.handleAllowed) {\n      return false;\n    }\n\n    e.stopPropagation();\n\n    if (this.scrollHandler.animatingScroll) {\n      return false;\n    }\n\n    this.lastTouch = { x: e.touches[0].clientX, y: e.touches[0].clientY };\n    this.touchMoves = [];\n    this.dragging = true;\n\n    return false;\n  }\n\n  handleTouchMoveEvent(e) {\n    if (!this.scrollHandler.handleAllowed) {\n      return false;\n    }\n\n    if (!this.dragging) {\n      return false;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (this.scrollHandler.animatingScroll) {\n      return false;\n    }\n\n    const touch = { x: e.touches[0].clientX, y: e.touches[0].clientY };\n\n    if (this.lastTouch !== undefined) {\n      const speed = this.scrollHandler.speed;\n\n      const deltaX = Math.round(this.lastTouch.x - touch.x) * 2 * speed;\n      const deltaY = Math.round(this.lastTouch.y - touch.y) * 2 * speed;\n\n      this.scrollHandler.handleScrollEvent(e, deltaX, deltaY, 0, undefined);\n\n      this.touchMoves.push({\n        date: new Date(),\n        deltaX: deltaX,\n        deltaY: deltaY\n      })\n    }\n\n    this.lastTouch = touch;\n  }\n\n  handleTouchEndEvent(e) {\n    if (!this.scrollHandler.handleAllowed) {\n      return false;\n    }\n\n    if (!this.dragging) {\n      return false;\n    }\n\n    this.lastTouch = undefined;\n    this.dragging = false;\n\n    if (this.scrollHandler.animatingScroll) {\n      return false;\n    }\n\n    this.handleTouchEndInertia(e, this.touchMoves);\n  }\n\n  handleTouchEndInertia(e, touches) {\n    const a = 220; // duration\n    const b = 0.1; // decrease\n    const c = 7.5; // amplitude\n    const ease = x => {\n      if (x > a) {\n        return 0;\n      } else if (x <= 0) {\n        return 1;\n      } else {\n        const f = (x, a, b) => (Math.acos(b * 2 / a * x - 1) / Math.PI);\n        return c * f(x, a, 1) / f(x, a, b);\n      }\n    };\n\n    const result = touches.map(item => {\n      const now: any = new Date();\n      const multiply = ease(now - item.date);\n\n      return {\n        deltaX: item.deltaX * multiply,\n        deltaY: item.deltaY * multiply\n      };\n    }).reduce((sum, item) => {\n      return {\n        deltaX: sum.deltaX + item.deltaX,\n        deltaY: sum.deltaY + item.deltaY\n      };\n    }, {\n      deltaX: 0,\n      deltaY: 0\n    });\n\n    const delta = Math.abs(result.deltaX) + Math.abs(result.deltaY);\n    const duration = 0.16 * 3 * delta / 150;\n\n    this.scrollHandler.handleScrollEvent(e, result.deltaX, result.deltaY, duration, Power4.easeOut);\n  }\n\n  onStickTo(position: number) { }\n}\n"]}