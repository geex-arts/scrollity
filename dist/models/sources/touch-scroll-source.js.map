{"version":3,"sources":["../../../src/models/sources/touch-scroll-source.ts"],"names":[],"mappings":"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","file":"touch-scroll-source.js","sourceRoot":"","sourcesContent":["import { NgZone } from '@angular/core';\n\nimport { ScrollHandler } from '../handlers/scroll-handler';\nimport { ScrollSource } from './scroll-source.interface';\n\nexport class TouchScrollSource implements ScrollSource {\n\n  touchStartListener: any;\n  touchMoveListener: any;\n  touchEndListener: any;\n  lastTouch;\n  touchMoves = [];\n\n  constructor(private scrollHandler: ScrollHandler,\n              private zone: NgZone) { }\n\n  bind() {\n    this.zone.runOutsideAngular(() => {\n      this.touchStartListener = e => {\n        return this.handleTouchStartEvent(e);\n      };\n\n      this.touchMoveListener = e => {\n        return this.handleTouchMoveEvent(e);\n      };\n\n      this.touchEndListener = () => {\n        return this.handleTouchEndEvent();\n      };\n\n      document.body.addEventListener('touchstart', this.touchStartListener);\n      document.body.addEventListener('touchmove', this.touchMoveListener);\n      document.body.addEventListener('touchend', this.touchEndListener);\n    });\n  }\n\n  unbind() {\n    if (this.touchStartListener) {\n      document.body.removeEventListener('touchstart', this.touchStartListener);\n    }\n\n    if (this.touchMoveListener) {\n      document.body.removeEventListener('touchend', this.touchMoveListener);\n    }\n\n    if (this.touchEndListener) {\n      document.body.removeEventListener('touchmove', this.touchEndListener);\n    }\n  }\n\n  handleTouchStartEvent(e) {\n    if (!this.scrollHandler.handleAllowed) {\n      return false;\n    }\n\n    e.stopPropagation();\n\n    if (this.scrollHandler.animatingScroll) {\n      return false;\n    }\n\n    this.lastTouch = { x: e.touches[0].clientX, y: e.touches[0].clientY };\n    this.touchMoves = [];\n\n    return false;\n  }\n\n  handleTouchMoveEvent(e) {\n    if (!this.scrollHandler.handleAllowed) {\n      return false;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (this.scrollHandler.animatingScroll) {\n      return false;\n    }\n\n    const touch = { x: e.touches[0].clientX, y: e.touches[0].clientY };\n\n    if (this.lastTouch !== undefined) {\n      const speed = 1;\n\n      const deltaX = Math.round(this.lastTouch.x - touch.x) * speed;\n      const deltaY = Math.round(this.lastTouch.y - touch.y) * speed;\n\n      this.scrollHandler.handleScrollEvent(deltaX, deltaY, 0);\n\n      this.touchMoves.push({\n        date: new Date(),\n        deltaX: deltaX,\n        deltaY: deltaY\n      })\n    }\n\n    this.lastTouch = touch;\n  }\n\n  handleTouchEndEvent() {\n    if (!this.scrollHandler.handleAllowed) {\n      return false;\n    }\n\n    this.lastTouch = undefined;\n\n    if (this.scrollHandler.animatingScroll) {\n      return false;\n    }\n\n    this.handleTouchEndInertia(this.touchMoves);\n  }\n\n  handleTouchEndInertia(touches) {\n    const a = 220; // duration\n    const b = 0.1; // decrease\n    const c = 5; // amplitude\n    const ease = x => {\n      if (x > a) {\n        return 0;\n      } else if (x <= 0) {\n        return 1;\n      } else {\n        const f = (x, a, b) => (Math.acos(b * 2 / a * x - 1) / Math.PI);\n        return c * f(x, a, 1) / f(x, a, b);\n      }\n    };\n\n    const result = touches.map(item => {\n      const now: any = new Date();\n      const multiply = ease(now - item.date);\n\n      return {\n        deltaX: item.deltaX * multiply,\n        deltaY: item.deltaY * multiply\n      };\n    }).reduce((sum, item) => {\n      return {\n        deltaX: sum.deltaX + item.deltaX,\n        deltaY: sum.deltaY + item.deltaY\n      };\n    }, {\n      deltaX: 0,\n      deltaY: 0\n    });\n\n    this.scrollHandler.handleScrollEvent(result.deltaX, result.deltaY, 0.16 * 3);\n  }\n\n  onStickTo(position: number) { }\n}\n"]}